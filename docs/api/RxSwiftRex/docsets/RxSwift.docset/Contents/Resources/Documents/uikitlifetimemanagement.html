<!DOCTYPE html>
<html lang="en">
  <head>
    <title>UIKitLifetimeManagement  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="UIKitLifetimeManagement  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">RxSwift 0.8.6 Docs</a> (96% documented)</p>
        <p class="header-right"><a href="https://github.com/SwiftRex/SwiftRex"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">RxSwift Reference</a>
        <img id="carat" src="img/carat.png" />
        UIKitLifetimeManagement  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="actionenumproperties.html">ActionEnumProperties</a>
              </li>
              <li class="nav-group-task">
                <a href="combinerex.html">CombineRex</a>
              </li>
              <li class="nav-group-task">
                <a href="quickguide.html">QuickGuide</a>
              </li>
              <li class="nav-group-task">
                <a href="reactiveswiftrex.html">ReactiveSwiftRex</a>
              </li>
              <li class="nav-group-task">
                <a href="rxswiftrex.html">RxSwiftRex</a>
              </li>
              <li class="nav-group-task">
                <a href="statemanagement.html">StateManagement</a>
              </li>
              <li class="nav-group-task">
                <a href="swiftrex.html">SwiftRex</a>
              </li>
              <li class="nav-group-task">
                <a href="uikitlifetimemanagement.html">UIKitLifetimeManagement</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AsyncSubject.html">AsyncSubject</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/BehaviorSubject.html">BehaviorSubject</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/BooleanDisposable.html">BooleanDisposable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CompositeDisposable.html">CompositeDisposable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CompositeDisposable.html#/s:7RxSwift19CompositeDisposableC10DisposeKeyV">– DisposeKey</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ConcurrentDispatchQueueScheduler.html">ConcurrentDispatchQueueScheduler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ConcurrentMainScheduler.html">ConcurrentMainScheduler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ConnectableObservable.html">ConnectableObservable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CurrentThreadScheduler.html">CurrentThreadScheduler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DisposeBag.html">DisposeBag</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DisposeBag/DisposableBuilder.html">– DisposableBuilder</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes.html#/s:7RxSwift11DisposeBaseC">DisposeBase</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HistoricalScheduler.html">HistoricalScheduler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MainScheduler.html">MainScheduler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Observable.html">Observable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/OperationQueueScheduler.html">OperationQueueScheduler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PublishSubject.html">PublishSubject</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RefCountDisposable.html">RefCountDisposable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ReplaySubject.html">ReplaySubject</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ScheduledDisposable.html">ScheduledDisposable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SerialDispatchQueueScheduler.html">SerialDispatchQueueScheduler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SerialDisposable.html">SerialDisposable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SingleAssignmentDisposable.html">SingleAssignmentDisposable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/VirtualTimeScheduler.html">VirtualTimeScheduler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Global%20Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Global%20Variables.html#/s:7RxSwift29maxTailRecursiveSinkStackSizeSivp">maxTailRecursiveSinkStackSize</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/CompletableEvent.html">CompletableEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums.html#/s:7RxSwift16CompletableTraitO">CompletableTrait</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Event.html">Event</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Hooks.html">Hooks</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/InfallibleEvent.html">InfallibleEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MaybeEvent.html">MaybeEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums.html#/s:7RxSwift10MaybeTraitO">MaybeTrait</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RxError.html">RxError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums.html#/s:7RxSwift11SingleTraitO">SingleTrait</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SubjectLifetimeScope.html">SubjectLifetimeScope</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TakeBehavior.html">TakeBehavior</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/VirtualTimeComparison.html">VirtualTimeComparison</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions.html#/s:10Foundation11JSONDecoderC">JSONDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions.html#/c:objc(cs)NSObject">NSObject</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions.html#/s:10Foundation19PropertyListDecoderC">PropertyListDecoder</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/Cancelable.html">Cancelable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ConnectableObservableType.html">ConnectableObservableType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DataDecoder.html">DataDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Disposable.html">Disposable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/EventConvertible.html">EventConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ImmediateSchedulerType.html">ImmediateSchedulerType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/InfallibleType.html">InfallibleType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ObservableConvertibleType.html">ObservableConvertibleType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ObservableType.html">ObservableType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ObserverType.html">ObserverType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/PrimitiveSequenceType.html">PrimitiveSequenceType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ReactiveCompatible.html">ReactiveCompatible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SchedulerType.html">SchedulerType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SubjectType.html">SubjectType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/VirtualTimeConverterType.html">VirtualTimeConverterType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AnyObserver.html">AnyObserver</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Binder.html">Binder</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Disposables.html">Disposables</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/GroupedObservable.html">GroupedObservable</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HistoricalSchedulerTimeConverter.html">HistoricalSchedulerTimeConverter</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Infallible.html">Infallible</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PrimitiveSequence.html">PrimitiveSequence</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Reactive.html">Reactive</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Resources.html">Resources</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7RxSwift11Completablea">Completable</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7RxSwift5Maybea">Maybe</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7RxSwift0A15AbstractIntegera">RxAbstractInteger</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7RxSwift0A4Timea">RxTime</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7RxSwift0A12TimeIntervala">RxTimeInterval</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7RxSwift6Singlea">Single</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:7RxSwift11SingleEventa">SingleEvent</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='uikit-lifetime-management' class='heading'>🌪 UIKit lifetime management</h1>

<p>Now imagine that you start an API call to add a movie to your favorites from your details page, but you close that screen before it completes. Having the API Client in your ViewController means that once the screen is dismissed, the completion handler block may not be called, and eventual loggers, trackers or state updates won&rsquo;t happen. That&rsquo;s why we keep API Client and analytics trackers as singletons, independent from UIKit life cycle. As the system grows, we have more and more of these classes making side-effects and all of them is a dependency that must be resolved, or injected, on your ViewController. And that&rsquo;s not enough, if the completion handler of any of these classes need some updated View State to complete other tasks, as analytics trackers for example, you can&rsquo;t simply capture <code>[unowned self]</code> or <code>[weak self]</code> with <code>guard let</code>. Let&rsquo;s illustrate the problem:</p>
<pre class="highlight swift"><code><span class="n">api</span><span class="o">.</span><span class="nf">fetchNextPage</span><span class="p">(</span><span class="nv">pageNumber</span><span class="p">:</span> <span class="n">currentPage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="nv">query</span><span class="p">:</span> <span class="n">searchBar</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">pageResults</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">strongSelf</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="n">strongSelf</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">strongSelf</span><span class="o">.</span><span class="n">dataSource</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">pageResults</span><span class="p">)</span>

    <span class="n">strongSelf</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="nf">trackNextPage</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="n">strongSelf</span><span class="o">.</span><span class="n">searchBar</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                     <span class="nv">page</span><span class="p">:</span> <span class="n">strongSelf</span><span class="o">.</span><span class="n">currentPage</span><span class="p">,</span>
                                     <span class="nv">size</span><span class="p">:</span> <span class="n">pageResults</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
                                     <span class="nv">screenName</span><span class="p">:</span> <span class="n">strongSelf</span><span class="o">.</span><span class="n">screenName</span><span class="p">,</span>
                                     <span class="nv">isUserLoggedIn</span><span class="p">:</span> <span class="n">strongSelf</span><span class="o">.</span><span class="n">userState</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Now, if the ViewController above is dismissed most of the completion block is not necessary anyway. But still we want to track to our analytics system, and because the <code>tracker</code> is part of the ViewController, this will never be called. The solution is to capture <code>tracker</code> in the capture block, but not only that, also everything used in the <code>trackNextPage</code> call.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">queryText</span> <span class="o">=</span> <span class="n">searchBar</span><span class="o">.</span><span class="n">text</span>
<span class="k">let</span> <span class="nv">screenName</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">screenName</span>
<span class="k">let</span> <span class="nv">nextPage</span> <span class="o">=</span> <span class="n">currentPage</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">let</span> <span class="nv">isUserLoggedIn</span> <span class="o">=</span> <span class="n">userState</span> <span class="o">!=</span> <span class="kc">nil</span>

<span class="n">api</span><span class="o">.</span><span class="nf">fetchNextPage</span><span class="p">(</span><span class="nv">pageNumber</span><span class="p">:</span> <span class="n">nextPage</span><span class="p">,</span>
                  <span class="nv">query</span><span class="p">:</span> <span class="n">searchBar</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">,</span> <span class="n">tracker</span><span class="p">]</span> <span class="n">pageResults</span> <span class="k">in</span>

    <span class="n">tracker</span><span class="o">.</span><span class="nf">trackNextPage</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="n">queryText</span><span class="p">,</span>
                          <span class="nv">page</span><span class="p">:</span> <span class="n">nextPage</span><span class="p">,</span>
                          <span class="nv">size</span><span class="p">:</span> <span class="n">pageResults</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
                          <span class="nv">screenName</span><span class="p">:</span> <span class="n">screenName</span><span class="p">,</span>
                          <span class="n">isUserLoggedIn</span><span class="p">)</span>

    <span class="k">guard</span> <span class="k">let</span> <span class="nv">strongSelf</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="n">strongSelf</span><span class="o">.</span><span class="n">currentPage</span> <span class="o">=</span> <span class="n">nextPage</span>
    <span class="n">strongSelf</span><span class="o">.</span><span class="n">dataSource</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">pageResults</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Other solution would be moving the tracker logic to the response of <code>api.fetchNextPage</code>, which can violate again some responsibilities and demand you to call this method with more parameters than it should need, just to satisfy other side-effects there, the tracking.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="https://github.com/SwiftRex/SwiftRex" target="_blank" rel="external">SwiftRex</a>. All rights reserved. (Last updated: 2021-11-20)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.7</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
